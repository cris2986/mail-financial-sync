ENUNCIADO FUNCIONAL CENTRAL

Mail Financial Sync es un visor financiero autom√°tico que extrae y consolida eventos financieros expl√≠citos desde el correo del usuario para entregar una vista mensual parcial de ingresos y egresos, sin reemplazar estados de cuenta bancarios ni realizar contabilidad formal.

Este enunciado gobierna todas las decisiones:
	‚Ä¢	No contabilidad.
	‚Ä¢	No open banking.
	‚Ä¢	No precisi√≥n bancaria.
	‚Ä¢	S√≠ visibilidad autom√°tica.
	‚Ä¢	S√≠ simplicidad.
	‚Ä¢	S√≠ control manual del usuario.
	‚Ä¢	Alcance limitado y deliberado.

‚∏ª

üìê Tech Doc ‚Äî Arquitectura y Dise√±o T√©cnico

‚∏ª

Estado de implementacion actual (February 17, 2026)

Este documento combina arquitectura objetivo y estado actual.

Estado actual en codigo:
	‚Ä¢	Frontend SPA funcional.
	‚Ä¢	OAuth real con Google Identity Services desde cliente.
	‚Ä¢	Integracion real con Gmail API (scope readonly).
	‚Ä¢	Extraccion y consolidacion de eventos financieros en cliente.

Las secciones de backend y contratos API se mantienen como evolucion recomendada para endurecimiento de seguridad, observabilidad y escalabilidad.

‚∏ª

1. Visi√≥n t√©cnica

‚Ä¢ Nombre del producto: Mail Financial Sync
‚Ä¢ Objetivo t√©cnico: Extraer eventos financieros detectables desde correo y consolidarlos en una vista mensual parcial, segura y editable.
‚Ä¢ Tipo de app: PWA client-heavy con backend serverless.
‚Ä¢ Restricciones expl√≠citas:
	‚Ä¢	No reconciliaci√≥n bancaria.
	‚Ä¢	No procesamiento de correo completo persistido.
	‚Ä¢	No IA pesada en MVP.
	‚Ä¢	Solo Gmail en MVP.
‚Ä¢ Offline-first: No (requiere API correo).
‚Ä¢ Privacidad local: S√≠, persistencia m√≠nima y encriptada.
‚Ä¢ Presupuesto/infraestructura: Bajo costo, serverless, sin servidores dedicados.
‚Ä¢ Dispositivos objetivo: Desktop y m√≥vil v√≠a navegador.

‚∏ª

2. Arquitectura general

‚Ä¢ Estilo arquitect√≥nico: SPA client-heavy + BFF serverless.

Separaci√≥n de capas

UI ‚Üí Renderizaci√≥n
Dominio ‚Üí Reglas de evento financiero
Servicios ‚Üí Parsing, consolidaci√≥n
Infraestructura ‚Üí API correo, persistencia

Flujo de datos

UI ‚Üí State ‚Üí Services ‚Üí API Gmail ‚Üí Backend ‚Üí Persistencia ‚Üí UI

Decisiones clave
	‚Ä¢	Client-heavy para reducir costos.
	‚Ä¢	Backend m√≠nimo solo para OAuth y procesamiento controlado.
	‚Ä¢	No l√≥gica financiera compleja en servidor.
	‚Ä¢	Modelo simple de eventos financieros.

‚∏ª

3. Frontend

3.1 Stack

‚Ä¢ Framework: React
‚Ä¢ Lenguaje: TypeScript
‚Ä¢ Bundler: Vite
‚Ä¢ Librer√≠as base: React Router, Zustand (estado), Axios, date-fns

‚∏ª

3.2 Estructura

src/
 ‚îú‚îÄ components/
 ‚îú‚îÄ pages/
 ‚îú‚îÄ state/
 ‚îú‚îÄ services/
 ‚îú‚îÄ hooks/
 ‚îú‚îÄ styles/
 ‚îú‚îÄ utils/


‚∏ª

3.3 Componentes

‚Ä¢ Principios:
	‚Ä¢	Simples.
	‚Ä¢	Predecibles.
	‚Ä¢	Sin l√≥gica financiera compleja en UI.

‚Ä¢ Componentes base:
	‚Ä¢	SummaryCard
	‚Ä¢	EventItem
	‚Ä¢	MonthSelector
	‚Ä¢	EmptyState
	‚Ä¢	ErrorState

‚Ä¢ Componentes compuestos:
	‚Ä¢	MonthlyDashboard
	‚Ä¢	EventList

‚Ä¢ Reglas:
	‚Ä¢	UI no procesa datos.
	‚Ä¢	Toda l√≥gica en services.

‚∏ª

3.4 Estado

‚Ä¢ Tipo: Global liviano + local.
‚Ä¢ Librer√≠a: Zustand.
‚Ä¢ Flujo: Servicios actualizan store ‚Üí UI re-renderiza.
‚Ä¢ Global: Usuario, eventos, resumen mensual.
‚Ä¢ Local: Estados de UI.

‚∏ª

3.5 Navegaci√≥n

‚Ä¢ Tipo: SPA con React Router.
‚Ä¢ Rutas:
	‚Ä¢	/login
	‚Ä¢	/dashboard
	‚Ä¢	/history
‚Ä¢ Guards:
	‚Ä¢	Dashboard requiere autenticaci√≥n.

‚∏ª

3.6 Manejo de estados UX

‚Ä¢ Loading: skeleton simple.
‚Ä¢ Empty: ‚ÄúNo se detectaron eventos‚Äù.
‚Ä¢ Error: mensaje claro sin tecnicismos.
‚Ä¢ Offline: aviso informativo.

‚∏ª

3.7 Theming y accesibilidad

‚Ä¢ Tokens:
	‚Ä¢	Escala de grises + color primario.
	‚Ä¢	Espaciado 8px base.
‚Ä¢ Dark/Light: S√≠.
‚Ä¢ Accesibilidad:
	‚Ä¢	Contraste m√≠nimo AA.
	‚Ä¢	Tipograf√≠a m√≠nima 14px.
	‚Ä¢	Navegaci√≥n teclado b√°sica.

‚∏ª

4. Backend

4.1 Rol del backend

‚Ä¢ Tipo: BFF serverless.
‚Ä¢ Responsabilidades:
	‚Ä¢	OAuth Gmail.
	‚Ä¢	Interacci√≥n segura con API Gmail.
	‚Ä¢	Parsing controlado.
‚Ä¢ Qu√© no hace:
	‚Ä¢	No guarda correos completos.
	‚Ä¢	No l√≥gica financiera avanzada.

‚∏ª

4.2 Stack

‚Ä¢ Lenguaje: TypeScript
‚Ä¢ Framework: Node.js + Express (serverless adaptado)
‚Ä¢ Runtime: Cloudflare Workers o Vercel Functions

‚∏ª

4.3 Estructura

api/
 ‚îú‚îÄ routes/
 ‚îú‚îÄ controllers/
 ‚îú‚îÄ services/
 ‚îú‚îÄ models/


‚∏ª

4.4 Manejo de errores

‚Ä¢ Formato est√°ndar:

{
  "error": "string",
  "code": "string"
}

‚Ä¢ Logging: solo errores cr√≠ticos.
‚Ä¢ No exponer stacktrace.

‚∏ª

5. Contratos API

5.1 Convenciones

‚Ä¢ Versionado: /v1
‚Ä¢ Autenticaci√≥n: Bearer token JWT
‚Ä¢ Formato: JSON

‚∏ª

5.2 Endpoints

GET /v1/events
GET /v1/summary
DELETE /v1/events/{id}
POST /v1/auth/login
POST /v1/auth/logout

‚∏ª

5.3 DTO

{
  "id": "string",
  "amount": number,
  "direction": "income | expense",
  "type": "card | credit | service | transfer | income",
  "date": "ISO string",
  "source": "string"
}


‚∏ª

6. Persistencia y datos

‚Ä¢ Tipo: Base de datos ligera (Supabase o similar).
‚Ä¢ Modelo inicial:
	‚Ä¢	User
	‚Ä¢	Event
‚Ä¢ Migraciones: manual controladas.
‚Ä¢ Backups: autom√°ticos del proveedor.
‚Ä¢ Encriptaci√≥n: en tr√°nsito y reposo.

‚∏ª

7. Autenticaci√≥n y seguridad

‚Ä¢ ¬øHay auth?: S√≠
‚Ä¢ Tipo: OAuth Gmail
‚Ä¢ Sesiones: JWT corto + refresh
‚Ä¢ Permisos: solo lectura de correos financieros
‚Ä¢ Datos sensibles: tokens OAuth
‚Ä¢ Evitar:
	‚Ä¢	Persistir cuerpo completo del correo
	‚Ä¢	Logs con datos financieros

‚∏ª

8. Performance

‚Ä¢ Objetivo:
	‚Ä¢	Carga inicial <2s
	‚Ä¢	Dashboard <1s tras login
‚Ä¢ Caching:
	‚Ä¢	Eventos cacheados por sesi√≥n
‚Ä¢ Lazy loading:
	‚Ä¢	Historial por mes
‚Ä¢ No optimizar:
	‚Ä¢	Micro-optimizaci√≥n prematura

‚∏ª

9. Testing y calidad

‚Ä¢ Tests:
	‚Ä¢	Unitarios (parsing)
	‚Ä¢	Integraci√≥n (API Gmail mock)
‚Ä¢ Siempre testear:
	‚Ä¢	Clasificaci√≥n ingreso/egreso
‚Ä¢ Manual:
	‚Ä¢	Flujo OAuth
‚Ä¢ Pre-release:
	‚Ä¢	Dataset real anonimizado

‚∏ª

10. Build, deploy y entornos

‚Ä¢ Entornos:
	‚Ä¢	dev
	‚Ä¢	staging
	‚Ä¢	prod
‚Ä¢ Variables:
	‚Ä¢	CLIENT_ID
	‚Ä¢	CLIENT_SECRET
‚Ä¢ Build:
	‚Ä¢	Vite build
‚Ä¢ Deploy:
	‚Ä¢	Vercel
‚Ä¢ Rollback:
	‚Ä¢	Deploy anterior autom√°tico

‚∏ª

11. Observabilidad

‚Ä¢ Logging:
	‚Ä¢	Errores backend
‚Ä¢ Errores:
	‚Ä¢	Sentry
‚Ä¢ M√©tricas:
	‚Ä¢	Eventos detectados
	‚Ä¢	Errores parsing
‚Ä¢ Alertas:
	‚Ä¢	Fallo OAuth

‚∏ª

12. Convenciones de desarrollo

‚Ä¢ Naming:
	‚Ä¢	camelCase variables
	‚Ä¢	PascalCase componentes
‚Ä¢ Commits:
	‚Ä¢	feat:
	‚Ä¢	fix:
	‚Ä¢	refactor:
‚Ä¢ Branching:
	‚Ä¢	main
	‚Ä¢	feature/*
‚Ä¢ IA:
	‚Ä¢	No introducir librer√≠as sin aprobaci√≥n.
	‚Ä¢	No ampliar alcance.
‚Ä¢ No permitido:
	‚Ä¢	Funciones fuera del enunciado central.

‚∏ª

13. Riesgos y decisiones

Decisiones tomadas
	‚Ä¢	Solo Gmail MVP.
	‚Ä¢	Sin contabilidad formal.
	‚Ä¢	Serverless.

Trade-offs
	‚Ä¢	Datos parciales aceptados.
	‚Ä¢	No offline-first.

Riesgos
	‚Ä¢	Pol√≠ticas Google.
	‚Ä¢	Precisi√≥n parsing.
	‚Ä¢	Confianza usuario.

Revisi√≥n futura
	‚Ä¢	Multi-correo.
	‚Ä¢	Mejora clasificaci√≥n.

‚∏ª

14. Ap√©ndice

Glosario

Evento financiero: registro detectado desde correo con monto y direcci√≥n.

Referencias

Gmail API Docs
OAuth 2.0 Spec

Diagrama alto nivel

Usuario ‚Üí PWA ‚Üí Backend ‚Üí Gmail API ‚Üí Backend ‚Üí DB ‚Üí PWA
